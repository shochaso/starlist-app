name: Release (tag & GH release)

on:
  push:
    branches: [main]

jobs:
  release:
    name: release (main)
    runs-on: ubuntu-latest
    permissions:
      contents: write    # tag・release作成に必要
    steps:
      - uses: actions/checkout@v4
      - id: ver
        run: |
          date +"%Y.%m.%d.%H%M" | awk '{print "v"$1}' > .ver
          echo "tag=$(cat .ver)" >> $GITHUB_OUTPUT
      - name: Create tag
        run: |
          git tag ${{ steps.ver.outputs.tag }}
          git push origin ${{ steps.ver.outputs.tag }}
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ steps.ver.outputs.tag }}
          generate_release_notes: true

