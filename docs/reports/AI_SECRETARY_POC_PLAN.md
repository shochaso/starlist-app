Status:: 
Source-of-Truth:: (TBD)
Spec-State:: 
Last-Updated:: 


# AIç§˜æ›¸æ©Ÿèƒ½ PoCå®Ÿè£…è¨ˆç”»

## ğŸ“… å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

### ãƒ•ã‚§ãƒ¼ã‚º1: åŸºç›¤æ§‹ç¯‰ï¼ˆWeek 1-2ï¼‰
**ç›®æ¨™:** AIç§˜æ›¸ã®åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿é€£æºåŸºç›¤ã‚’æ§‹ç¯‰

#### ã‚¿ã‚¹ã‚¯1.1: Supabaseãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆ
- [ ] AIç§˜æ›¸ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ
  - `ai_conversations` - AIå¯¾è©±å±¥æ­´
  - `ai_insights` - AIåˆ†æçµæœ
  - `ai_schedules` - AIææ¡ˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
  - `ai_content_suggestions` - ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ææ¡ˆ
- [ ] RLSãƒãƒªã‚·ãƒ¼è¨­å®š
- [ ] Edge Functionsæº–å‚™

#### ã‚¿ã‚¹ã‚¯1.2: ãƒ‡ãƒ¼ã‚¿ãƒ–ãƒªãƒƒã‚¸å®Ÿè£…
- [ ] Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–
- [ ] Google Calendar APIé€£æº
- [ ] YouTube Data APIé€£æº
- [ ] ãƒ‡ãƒ¼ã‚¿åŒæœŸã‚µãƒ¼ãƒ“ã‚¹ä½œæˆ

#### ã‚¿ã‚¹ã‚¯1.3: AIå‡¦ç†åŸºç›¤
- [ ] OpenAI/Claude APIçµ±åˆ
- [ ] ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…

### ãƒ•ã‚§ãƒ¼ã‚º2: ã‚¹ã‚¿ãƒ¼å‘ã‘æ©Ÿèƒ½å®Ÿè£…ï¼ˆWeek 3-4ï¼‰
**ç›®æ¨™:** ã‚¹ã‚¿ãƒ¼ãŒAIç§˜æ›¸ã¨å¯¾è©±ã§ãã‚‹åŸºæœ¬UIã‚’å®Ÿè£…

#### ã‚¿ã‚¹ã‚¯2.1: AIãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”»é¢
- [ ] `ai_secretary_screen.dart` ä½œæˆ
- [ ] ãƒãƒ£ãƒƒãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®Ÿè£…
- [ ] ãƒ‡ãƒ¼ã‚¿ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [ ] Notionãƒ©ã‚¤ã‚¯ãªã‚«ãƒ¼ãƒ‰é…ç½®æ©Ÿèƒ½

#### ã‚¿ã‚¹ã‚¯2.2: ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ææ¡ˆæ©Ÿèƒ½
- [ ] éå»ã®æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿åˆ†æ
- [ ] æœ€é©ãªæŠ•ç¨¿æ™‚é–“ç®—å‡ºãƒ­ã‚¸ãƒƒã‚¯
- [ ] ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼çµ±åˆUI
- [ ] ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯æ‰¿èªæ©Ÿèƒ½

#### ã‚¿ã‚¹ã‚¯2.3: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼
- [ ] ãƒˆãƒ¬ãƒ³ãƒ‰æ¤œå‡ºæ©Ÿèƒ½
- [ ] ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ã‚¤ãƒ‡ã‚¢ç”Ÿæˆ
- [ ] ã‚¿ã‚¤ãƒˆãƒ«ãƒ»ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ææ¡ˆ
- [ ] ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆäºˆæ¸¬

### ãƒ•ã‚§ãƒ¼ã‚º3: ãƒ•ã‚¡ãƒ³å‘ã‘æ©Ÿèƒ½å®Ÿè£…ï¼ˆWeek 5-6ï¼‰
**ç›®æ¨™:** ãƒ•ã‚¡ãƒ³ãŒAIæ¨è–¦ã‚’å—ã‘ã‚‰ã‚Œã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…

#### ã‚¿ã‚¹ã‚¯3.1: ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºæ¨è–¦
- [ ] ãƒ•ã‚¡ãƒ³ã®è¦–è´å±¥æ­´åˆ†æ
- [ ] æ¨ã—ã‚¹ã‚¿ãƒ¼ã®å‚¾å‘åˆ†æ
- [ ] ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ¨è–¦
- [ ] æ¨è–¦ç†ç”±ã®å¯è¦–åŒ–

#### ã‚¿ã‚¹ã‚¯3.2: AIè¦ç´„æ©Ÿèƒ½
- [ ] ã‚¹ã‚¿ãƒ¼æ´»å‹•ã®è‡ªå‹•è¦ç´„
- [ ] ãƒˆãƒ¬ãƒ³ãƒ‰å¤‰åŒ–ã®é€šçŸ¥
- [ ] ãƒã‚¤ãƒ©ã‚¤ãƒˆæŠ½å‡º

### ãƒ•ã‚§ãƒ¼ã‚º4: æœ€é©åŒ–ã¨ãƒ†ã‚¹ãƒˆï¼ˆWeek 7-8ï¼‰
**ç›®æ¨™:** ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ã‚¹ãƒˆ

#### ã‚¿ã‚¹ã‚¯4.1: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- [ ] APIå‘¼ã³å‡ºã—æœ€é©åŒ–
- [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥å®Ÿè£…
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“æ”¹å–„
- [ ] ã‚³ã‚¹ãƒˆæœ€é©åŒ–

#### ã‚¿ã‚¹ã‚¯4.2: ãƒ†ã‚¹ãƒˆã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿæ–½
- [ ] ãƒ™ãƒ¼ã‚¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†ã¨æ”¹å–„

---

## ğŸ¯ å³åº§ã«ç€æ‰‹ã™ã¹ãã‚¿ã‚¹ã‚¯

### å„ªå…ˆåº¦1: Supabaseãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆã¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

#### 1. AIç§˜æ›¸ç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ
```sql
-- AIå¯¾è©±å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE ai_conversations (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  user_type TEXT CHECK (user_type IN ('star', 'fan')),
  message TEXT NOT NULL,
  response TEXT NOT NULL,
  context JSONB,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- AIåˆ†æçµæœãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE ai_insights (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  star_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  insight_type TEXT CHECK (insight_type IN ('engagement', 'trend', 'schedule', 'content')),
  title TEXT NOT NULL,
  summary TEXT NOT NULL,
  details JSONB,
  priority INTEGER DEFAULT 0,
  is_read BOOLEAN DEFAULT FALSE,
  valid_until TIMESTAMP WITH TIME ZONE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- AIææ¡ˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE ai_schedules (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  star_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  suggested_time TIMESTAMP WITH TIME ZONE NOT NULL,
  content_type TEXT NOT NULL,
  reason TEXT NOT NULL,
  estimated_engagement INTEGER,
  status TEXT CHECK (status IN ('pending', 'approved', 'rejected', 'completed')) DEFAULT 'pending',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- AIã‚³ãƒ³ãƒ†ãƒ³ãƒ„ææ¡ˆãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE ai_content_suggestions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  star_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  content_type TEXT NOT NULL,
  title TEXT NOT NULL,
  description TEXT NOT NULL,
  keywords TEXT[],
  estimated_engagement INTEGER,
  trend_relevance INTEGER,
  status TEXT CHECK (status IN ('new', 'in_progress', 'published', 'rejected')) DEFAULT 'new',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- RLSãƒãƒªã‚·ãƒ¼è¨­å®š
ALTER TABLE ai_conversations ENABLE ROW LEVEL SECURITY;
ALTER TABLE ai_insights ENABLE ROW LEVEL SECURITY;
ALTER TABLE ai_schedules ENABLE ROW LEVEL SECURITY;
ALTER TABLE ai_content_suggestions ENABLE ROW LEVEL SECURITY;

-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
CREATE POLICY "Users can view own conversations"
  ON ai_conversations FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own conversations"
  ON ai_conversations FOR INSERT
  WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Stars can view own insights"
  ON ai_insights FOR SELECT
  USING (auth.uid() = star_id);

CREATE POLICY "Stars can view own schedules"
  ON ai_schedules FOR SELECT
  USING (auth.uid() = star_id);

CREATE POLICY "Stars can update own schedules"
  ON ai_schedules FOR UPDATE
  USING (auth.uid() = star_id);

CREATE POLICY "Stars can view own content suggestions"
  ON ai_content_suggestions FOR SELECT
  USING (auth.uid() = star_id);

CREATE POLICY "Stars can update own content suggestions"
  ON ai_content_suggestions FOR UPDATE
  USING (auth.uid() = star_id);
```

### å„ªå…ˆåº¦2: Flutterå´ã®ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ä½œæˆ

#### 2. Dartãƒ¢ãƒ‡ãƒ«ã‚¯ãƒ©ã‚¹
```dart
// lib/features/ai_secretary/models/ai_conversation.dart
class AiConversation {
  final String id;
  final String userId;
  final String userType;
  final String message;
  final String response;
  final Map<String, dynamic>? context;
  final DateTime createdAt;

  AiConversation({
    required this.id,
    required this.userId,
    required this.userType,
    required this.message,
    required this.response,
    this.context,
    required this.createdAt,
  });

  factory AiConversation.fromJson(Map<String, dynamic> json) {
    return AiConversation(
      id: json['id'],
      userId: json['user_id'],
      userType: json['user_type'],
      message: json['message'],
      response: json['response'],
      context: json['context'],
      createdAt: DateTime.parse(json['created_at']),
    );
  }

  Map<String, dynamic> toJson() {
    return {
      'id': id,
      'user_id': userId,
      'user_type': userType,
      'message': message,
      'response': response,
      'context': context,
      'created_at': createdAt.toIso8601String(),
    };
  }
}

// lib/features/ai_secretary/models/ai_insight.dart
class AiInsight {
  final String id;
  final String starId;
  final String insightType;
  final String title;
  final String summary;
  final Map<String, dynamic>? details;
  final int priority;
  final bool isRead;
  final DateTime? validUntil;
  final DateTime createdAt;

  AiInsight({
    required this.id,
    required this.starId,
    required this.insightType,
    required this.title,
    required this.summary,
    this.details,
    required this.priority,
    required this.isRead,
    this.validUntil,
    required this.createdAt,
  });

  factory AiInsight.fromJson(Map<String, dynamic> json) {
    return AiInsight(
      id: json['id'],
      starId: json['star_id'],
      insightType: json['insight_type'],
      title: json['title'],
      summary: json['summary'],
      details: json['details'],
      priority: json['priority'],
      isRead: json['is_read'],
      validUntil: json['valid_until'] != null 
          ? DateTime.parse(json['valid_until']) 
          : null,
      createdAt: DateTime.parse(json['created_at']),
    );
  }
}

// lib/features/ai_secretary/models/ai_schedule.dart
class AiSchedule {
  final String id;
  final String starId;
  final DateTime suggestedTime;
  final String contentType;
  final String reason;
  final int? estimatedEngagement;
  final String status;
  final DateTime createdAt;

  AiSchedule({
    required this.id,
    required this.starId,
    required this.suggestedTime,
    required this.contentType,
    required this.reason,
    this.estimatedEngagement,
    required this.status,
    required this.createdAt,
  });

  factory AiSchedule.fromJson(Map<String, dynamic> json) {
    return AiSchedule(
      id: json['id'],
      starId: json['star_id'],
      suggestedTime: DateTime.parse(json['suggested_time']),
      contentType: json['content_type'],
      reason: json['reason'],
      estimatedEngagement: json['estimated_engagement'],
      status: json['status'],
      createdAt: DateTime.parse(json['created_at']),
    );
  }
}

// lib/features/ai_secretary/models/ai_content_suggestion.dart
class AiContentSuggestion {
  final String id;
  final String starId;
  final String contentType;
  final String title;
  final String description;
  final List<String> keywords;
  final int? estimatedEngagement;
  final int? trendRelevance;
  final String status;
  final DateTime createdAt;

  AiContentSuggestion({
    required this.id,
    required this.starId,
    required this.contentType,
    required this.title,
    required this.description,
    required this.keywords,
    this.estimatedEngagement,
    this.trendRelevance,
    required this.status,
    required this.createdAt,
  });

  factory AiContentSuggestion.fromJson(Map<String, dynamic> json) {
    return AiContentSuggestion(
      id: json['id'],
      starId: json['star_id'],
      contentType: json['content_type'],
      title: json['title'],
      description: json['description'],
      keywords: List<String>.from(json['keywords'] ?? []),
      estimatedEngagement: json['estimated_engagement'],
      trendRelevance: json['trend_relevance'],
      status: json['status'],
      createdAt: DateTime.parse(json['created_at']),
    );
  }
}
```

### å„ªå…ˆåº¦3: ãƒªãƒã‚¸ãƒˆãƒªã¨ã‚µãƒ¼ãƒ“ã‚¹ä½œæˆ

#### 3. AIç§˜æ›¸ãƒªãƒã‚¸ãƒˆãƒª
```dart
// lib/features/ai_secretary/repositories/ai_secretary_repository.dart
import 'package:supabase_flutter/supabase_flutter.dart';
import '../models/ai_conversation.dart';
import '../models/ai_insight.dart';
import '../models/ai_schedule.dart';
import '../models/ai_content_suggestion.dart';

class AiSecretaryRepository {
  final SupabaseClient _supabase;

  AiSecretaryRepository(this._supabase);

  // å¯¾è©±å±¥æ­´ã®å–å¾—
  Future<List<AiConversation>> getConversations(String userId) async {
    final response = await _supabase
        .from('ai_conversations')
        .select()
        .eq('user_id', userId)
        .order('created_at', ascending: false)
        .limit(50);
    
    return (response as List)
        .map((json) => AiConversation.fromJson(json))
        .toList();
  }

  // æ–°ã—ã„å¯¾è©±ã‚’ä¿å­˜
  Future<AiConversation> saveConversation({
    required String userId,
    required String userType,
    required String message,
    required String response,
    Map<String, dynamic>? context,
  }) async {
    final data = {
      'user_id': userId,
      'user_type': userType,
      'message': message,
      'response': response,
      'context': context,
    };

    final result = await _supabase
        .from('ai_conversations')
        .insert(data)
        .select()
        .single();

    return AiConversation.fromJson(result);
  }

  // AIåˆ†æçµæœã®å–å¾—
  Future<List<AiInsight>> getInsights(String starId) async {
    final response = await _supabase
        .from('ai_insights')
        .select()
        .eq('star_id', starId)
        .order('priority', ascending: false)
        .order('created_at', ascending: false);
    
    return (response as List)
        .map((json) => AiInsight.fromJson(json))
        .toList();
  }

  // AIææ¡ˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å–å¾—
  Future<List<AiSchedule>> getSchedules(String starId) async {
    final response = await _supabase
        .from('ai_schedules')
        .select()
        .eq('star_id', starId)
        .order('suggested_time', ascending: true);
    
    return (response as List)
        .map((json) => AiSchedule.fromJson(json))
        .toList();
  }

  // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
  Future<void> updateScheduleStatus(String scheduleId, String status) async {
    await _supabase
        .from('ai_schedules')
        .update({'status': status})
        .eq('id', scheduleId);
  }

  // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ææ¡ˆã®å–å¾—
  Future<List<AiContentSuggestion>> getContentSuggestions(String starId) async {
    final response = await _supabase
        .from('ai_content_suggestions')
        .select()
        .eq('star_id', starId)
        .order('trend_relevance', ascending: false)
        .order('created_at', ascending: false);
    
    return (response as List)
        .map((json) => AiContentSuggestion.fromJson(json))
        .toList();
  }

  // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ææ¡ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
  Future<void> updateContentSuggestionStatus(
      String suggestionId, String status) async {
    await _supabase
        .from('ai_content_suggestions')
        .update({'status': status})
        .eq('id', suggestionId);
  }
}
```

---

## ğŸš€ æ¬¡ã®å…·ä½“çš„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### ä»Šã™ãå®Ÿè¡Œã™ã¹ãã“ã¨ï¼š

1. **Supabaseãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ**
   ```bash
   # æ–°ã—ã„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
   touch supabase/migrations/20251015_create_ai_secretary_tables.sql
   ```

2. **Flutterå´ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆ**
   ```bash
   mkdir -p lib/features/ai_secretary/{models,repositories,services,screens,widgets,providers}
   ```

3. **å¿…è¦ãªä¾å­˜é–¢ä¿‚ã®è¿½åŠ **
   ```yaml
   # pubspec.yaml ã«è¿½åŠ 
   dependencies:
     http: ^1.1.0
     # AI APIç”¨ï¼ˆOpenAI, Anthropic Claudeãªã©ï¼‰
   ```

4. **ç’°å¢ƒå¤‰æ•°è¨­å®š**
   ```bash
   # .env ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ 
   OPENAI_API_KEY=your_key_here
   # ã¾ãŸã¯
   ANTHROPIC_API_KEY=your_key_here
   ```

å®Ÿè£…ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿã©ã®ã‚¿ã‚¹ã‚¯ã‹ã‚‰å§‹ã‚ãŸã„ã‹æŒ‡ç¤ºã—ã¦ãã ã•ã„ï¼
