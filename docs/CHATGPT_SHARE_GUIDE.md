# STARLIST Spec Review Request Template

## 🎯 概要
このテンプレートを使用して、ChatGPTに仕様レビューリクエストを送信してください。
仕様の品質向上とコード・ドキュメントの同期を目的としています。

## 📋 テンプレート

```markdown
# STARLIST Spec Review Request

## 対象仕様
- File: docs/features/[category]/[feature_name].spec.md
- Status: [draft|review|final]
- 変更タイプ: [新規|更新|昇格]

## コード参照
- [Primary] lib/features/[path]/file.dart#L[start]-[end]
- [Secondary] lib/features/[path]/related.dart#L[start]-[end]

## 現在の仕様内容
[ここに現在のspec.mdの内容を貼り付け]

## レビュー依頼事項

### 1. 仕様の完全性チェック
- [ ] 目的・入出力・前提が明確に記載されているか
- [ ] UIステート遷移に漏れがないか
- [ ] エラーハンドリングが考慮されているか
- [ ] Supabase呼び出し仕様が最新か

### 2. コードとの同期チェック
- [ ] コードの実装と仕様が一致しているか
- [ ] APIエンドポイントが正しく記載されているか
- [ ] データ構造が一致しているか

### 3. 保守性・拡張性チェック
- [ ] 将来の機能拡張を考慮した設計か
- [ ] 他の機能との依存関係が明確か
- [ ] テスト容易性が考慮されているか

## 期待される出力

### 修正版仕様
```markdown
[修正された完全なspec.mdの内容]
```

### 差分サマリー
- **追加**: 新たに追加された仕様項目
- **修正**: 修正された内容と理由
- **削除**: 削除された内容と理由
- **懸念点**: 将来の課題や考慮すべき点

### レビューコメント
[仕様の品質に関するコメント]

---

*レビュアー: ChatGPT*
*最終更新: [日付]*
```

## 🔄 使用フロー

1. **仕様ファイルを開く** → docs/features/[...].spec.md
2. **内容をコピー** → 上記テンプレートの「現在の仕様内容」セクションに貼り付け
3. **コード参照を追加** → 関連するコードのファイルパスと行番号を記載
4. **ChatGPTに送信** → このテンプレートをプロンプトとして使用
5. **レビュー結果を反映** → 修正版をspec.mdに適用
6. **インデックス更新** → COMMON_DOCS_INDEX.mdに反映

## 📚 レビューポイント

### 仕様品質基準
- **目的**: なぜこの機能が必要か、明確に記載
- **入出力**: 受け取るデータ、返すデータが明確
- **前提**: この機能が動作するための条件
- **制約**: できないこと、制限事項

### コード同期チェック
- **APIエンドポイント**: Supabase関数名、テーブル名
- **データ構造**: 受け渡すデータの形式
- **エラーハンドリング**: 失敗時の挙動
- **ステート管理**: UIの状態変化

## 🎯 期待効果

- **仕様の標準化**: 一貫した品質のドキュメント
- **レビューの効率化**: 構造化されたチェック項目
- **コード品質向上**: 仕様と実装の同期強化
- **メンテナンス性向上**: 将来の変更時の影響把握

---
*このガイドは継続的に更新してください*

## 📋 優先共有Markdown（Day1〜Day3仕様セット）

### Day1: キャリア決済仕様群

| 仕様ID | タイトル | 1ページ要約 | 共有推奨度 |
|--------|----------|-------------|------------|
| PAY-CAR-CORE-001 | キャリア決済コアフロー | ✅ 個別購読決済の仕組み | 高 |
| PAY-CAR-UI-002 | 決済UI/UX | ✅ 3画面フロー＋注意書き | 高 |
| PAY-CAR-IDEMP-003 | 二重防止・冪等性 | ✅ idempotency_key＋再開トークン | 高 |
| PAY-CAR-POLICY-004 | 返金ポリシー | ✅ 原則不可＋例外条件 | 高 |

**共有テンプレート**: 「キャリア決済の決済フローと二重防止・返金ルールをレビューしてください」

### Day2: Stripe＋RLS＋返金統合仕様群

| 仕様ID | タイトル | 1ページ要約 | 共有推奨度 |
|--------|----------|-------------|------------|
| PAY-STR-WEBHOOK-003 | Stripe Webhook再送＋監査ログ | ✅ Webhook重複防止＋監査ログ | 高 |
| PAY-STR-CORE-001 | Stripe決済コアフロー | ✅ クレジットカード決済フロー | 高 |
| PAY-STR-SUBS-002 | Stripeサブスクリプション管理 | ✅ キャンセルルール＋entitlements | 高 |
| SEC-RLS-CORE-001 | RLSコアアクセス制御 | ✅ 5ロール権限マトリクス | 高 |
| SEC-RLS-STORAGE-002 | ストレージアクセス制御 | ✅ 署名URL60秒＋監査 | 高 |
| SEC-RLS-TEST-001 | RLS 5ロールテスト | ✅ CRUDテストケース | 中 |
| PAY-POLICY-COMMON-001 | 共通返金ポリシー | ✅ 原則不可＋例外フロー | 高 |

**共有テンプレート**: 「Stripe決済・RLSアクセス制御・返金ポリシーの統合仕様をレビューしてください」

### Day3: データ取り込み仕様群

| 仕様ID | タイトル | 1ページ要約 | 共有推奨度 |
|--------|----------|-------------|------------|
| ING-PIPE-CORE-001 | Ingestパイプラインコア | ✅ 重複防止＋PIIマスキング＋監査 | 高 |
| ING-OCR-IMAGE-002 | OCR画像解析 | ✅ Google Vision API＋信頼度管理 | 高 |
| ING-SCREENSHOT-003 | スクリーンショット処理 | ✅ UI除去＋モバイル最適化 | 中 |
| ING-YT-PIPE-004 | YouTubeデータ連携 | ✅ OAuth統合＋ライブ対応 | 高 |

**共有テンプレート**: 「データ取り込みパイプラインの重複防止・PII保護・OCR解析仕様をレビューしてください」

### 使用方法
1. 上記テーブルから該当する仕様を選択
2. 「現在の仕様内容」セクションにspec.mdの1ページ要約部分を貼り付け
3. テンプレート文言を使用してレビュー依頼
4. 特に**高**推奨度の仕様から優先的に共有

### 注意点
- 1ページ要約を使用することで、ChatGPTの理解を効率化
- 詳細仕様は必要に応じて追加で共有
- source_of_truth昇格済みの仕様を優先
