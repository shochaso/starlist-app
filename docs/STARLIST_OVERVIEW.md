# STARLIST プロジェクト概要

## 🎯 プロジェクト概要

STARLISTは、スター（インフルエンサー）とファンをつなぐモバイル/Webアプリケーションです。
スターの活動履歴（レシート・スクリーンショット・YouTube動画）を安全に収集・共有し、購読者限定の体験を提供します。

### 主要価値
- **スターの活動可視化**: レシート・スクショ・YouTubeを通じてスターの日常を共有
- **安全なデータ収集**: PII保護・重複防止・監査ログによる完全追跡
- **多様な決済統合**: Stripe/キャリア決済＋統一キャンセルルール
- **セキュアなアクセス制御**: RLSによる購読者限定コンテンツ配信

---

## アーキテクチャサマリー

| レイヤ | 技術 | メモ |
| --- | --- | --- |
| フロントエンド | Flutter (Dart) + Riverpod | モバイル/デスクトップ/Web を単一コードベースで提供。Chrome 開発用に `scripts/c.sh` を使用。 |
| バックエンド | NestJS (TypeScript) | `server/src/` 配下で ingest・media・metrics モジュールを提供。 |
| データ基盤 | Supabase (Postgres, Edge Functions) | マイグレーションで RLS を管理し、`exchange`/`sign-url` 関数を稼働。 |
| ストレージ | Supabase Storage | `doc-share` バケットを OCR・スクリーンショット・レシート等のファイル保管に使用。 |
| 決済 | Stripe + キャリア決済 | サブスク課金・返金 API を利用。Day1〜Day2で統一キャンセルルールを実装。 |
| データ取り込み | Ingest Pipeline + Google Cloud Vision API | Day3でレシート・YouTube・音楽・ゲーム・学習スクショを対象としたOCR解析を統合。 |

---

## 機能マップと進捗（更新）

| 機能カテゴリ | 現状ステータス | 次のアクション |
| --- | --- | --- |
| データインポート | ✅ **Day3完了**（OCR/スクショ/YouTube連携がsource_of_truth昇格） | Day4で認証・UI仕様を統合。 |
| 決済/サブスク | ✅ **Day1〜Day2完了**（Stripe/キャリア決済＋統一キャンセルルール） | 定期課金テレメトリとUIの精緻化。 |
| セキュリティ/RLS | ✅ RLS・PIIマスキング・監査ログを統合済み。 | entitlementsビューと認証連携の最終確認。 |
| 分析/レポート | 初期バージョン提供済（スターデータ画面） | 指標ダッシュボードの強化。 |
| AI/自動化 | 設計済み（AI秘書/スケジューラ） | PoC実装とテレメトリ統合。 |

### 全体進捗
- **Day1**: キャリア決済4本（20%） - ✅ 完了
- **Day2**: Stripe+RLS+返金統合7本（35%） - ✅ 完了  
- **Day3**: データ取り込み4本（20%） - ✅ 完了
- **Day4**: 残り5本（25%） - 🔜 次フェーズ
- **合計**: 15/20本（75%）完了

---

## 外部連携・依存サービス（追記）

| サービス | 利用目的 | 備考 |
| --- | --- | --- |
| **Google Cloud Vision API** | OCR解析（レシート・スクリーンショット） | 信頼度70%未満は再解析（最大3回） |
| **YouTube Data API v3** | 視聴データ・メタ取得 | OAuth統合／ライブ配信検知対応 |
| **Supabase Storage (`doc-share`)** | ファイル保管 | OCR・スクショ・明細データを保存し署名URLでアクセス管理 |

---

## 技術仕様ハイライト

### データ取り込みパイプライン
- **重複防止**: pHash + ファイルハッシュによる95%以上の類似度検知
- **PII保護**: 自動マスキング（メール/電話/住所 → `<PII:*>` 置換）
- **OCR品質**: Google Cloud Vision API + 信頼度閾値管理
- **監査追跡**: audit_ingestテーブルによる全操作ログ記録

### 決済統合
- **統一キャンセル**: 自動更新停止（期末まで閲覧可）を標準
- **二重防止**: idempotency_key + entitlementsテーブル
- **返金基準**: 当社起因のみ全額返金（監査ログ根拠）

### セキュリティ
- **RLS**: 購読者限定コンテンツアクセス
- **署名URL**: 60秒有効の一時アクセス
- **監査ログ**: 全操作の完全追跡（90日保持）

---

## 関連ドキュメント一覧（補足）

- `docs/COMMON_DOCS_INDEX.md` … ドキュメント目次。`1.4 データ連携／インポート詳細` に Day3仕様群（ING-PIPE-CORE-001〜ING-YT-PIPE-004）を追加。
- `docs/COMPANY_SETUP_GUIDE.md` … Supabase Storage `doc-share` 運用に「OCR/スクショファイル分類」「監査ログ保存方針」を追記。
- `docs/CHATGPT_SHARE_GUIDE.md` … 「データ取り込み仕様群」を優先共有Markdownとして登録。
- `docs/SUPABASE_STORAGE_OPERATIONS_GUIDE.md` … Storage運用・PIIマスキング基準の詳細ガイド。
- `docs/reports/` … Day1〜Day3進捗報告を格納。

---

## チーム構成・役割

| 役割 | 担当者 | 主要責任 |
| --- | --- | --- |
| COO/PM | ティム | 仕様品質管理・プロジェクト進行管理 |
| 開発者 | Mine | 実装・コード品質確保・AIレビュー対応 |
| QA/テスター | - | 仕様準拠確認・テストケース作成 |

---

## ロードマップ・今後の課題（更新）

- **Day4（最終フェーズ）**: 認証・UI・運用仕様の昇格。
- **目標**: 仕様20本のコンプリートと、仕様↔実装同期の自動化。
- **価値**: 決済・セキュリティ・データ領域の完全統合によるMVP品質到達。

### リスク管理
- **仕様漏れ**: AIレビュー + 人的確認の二重チェック体制
- **実装差分**: source_of_truth昇格時の同期確認
- **品質劣化**: 1ページ要約ベースのチーム理解統一

---

## 更新履歴

| 日付 | 更新者 | 変更箇所 |
| --- | --- | --- |
| 2025-11-07 | ティム（COO/PM） | Day3完了に伴いOCR対象拡張・機能マップ更新・外部連携追記 |

---

*このドキュメントは継続的に更新してください*
