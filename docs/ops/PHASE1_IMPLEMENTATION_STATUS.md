# Phase1: å®‰å®šåŒ–ãƒ•ã‚§ãƒ¼ã‚º å®Ÿè£…çŠ¶æ³

## ğŸ¯ ç›®çš„
releaseï¼‹workflow_dispatchã®å®Œå…¨åŒæœŸã€èª¤ãƒˆãƒªã‚¬é®æ–­ã€ã‚¿ã‚°è§£æ±ºãƒ­ãƒã‚¹ãƒˆåŒ–ã‚’ç¢ºç«‹ã™ã‚‹ã€‚

## âœ… å®Ÿè£…çŠ¶æ³

### 1. `.github/workflows/slsa-provenance.yml` æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯

#### ç¾çŠ¶ç¢ºèª
- âœ… `if: github.event_name != 'push'` - å®Ÿè£…æ¸ˆã¿ï¼ˆ27è¡Œç›®ï¼‰
- âœ… `workflow_dispatch` ãƒˆãƒªã‚¬ãƒ¼ - å®Ÿè£…æ¸ˆã¿ï¼ˆ6-10è¡Œç›®ï¼‰
- âœ… `release` ãƒˆãƒªã‚¬ãƒ¼ - å®Ÿè£…æ¸ˆã¿ï¼ˆ11-12è¡Œç›®ï¼‰
- âœ… ã‚¿ã‚°è§£æ±ºãƒ­ã‚¸ãƒƒã‚¯ - 3æ®µéšãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…æ¸ˆã¿ï¼ˆ42-60è¡Œç›®ï¼‰
  - 1æ®µéš: `github.event.release.tag_name`
  - 2æ®µéš: `inputs.tag`
  - 3æ®µéš: `git describe --tags`
- âœ… concurrencyè¨­å®š - å®Ÿè£…æ¸ˆã¿ï¼ˆ20-22è¡Œç›®ï¼‰

#### æ”¹å–„ç‚¹
- [ ] `inputs.tag` ã® `required: true` ã‚’ `required: false` ã«å¤‰æ›´ï¼ˆreleaseã‚¤ãƒ™ãƒ³ãƒˆæ™‚ã¯ä¸è¦ï¼‰
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¼·åŒ–
- [ ] ãƒ­ã‚°å‡ºåŠ›ã®æ”¹å–„

### 2. `release.yml` â†’ `workflow_dispatch` ã®ãƒˆãƒ¼ã‚¯ãƒ³çµŒè·¯

#### ç¾çŠ¶ç¢ºèª
- âœ… PATæ–¹å¼ - å®Ÿè£…æ¸ˆã¿ï¼ˆ139-144è¡Œç›®ï¼‰
  - `GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}` ã‚’ä½¿ç”¨
  - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: `|| echo "Dispatch failed, will be triggered by release event"`
- âœ… ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ - releaseã‚¤ãƒ™ãƒ³ãƒˆã«ä¾å­˜ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

#### æ”¹å–„ç‚¹
- [ ] OIDCåŒ–ã®æ¤œè¨ï¼ˆå°†æ¥å¯¾å¿œï¼‰
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®è©³ç´°åŒ–

### 3. ãƒˆãƒªã‚¬ãƒ¼ãƒ†ã‚¹ãƒˆå®Ÿæ–½è¨ˆç”»

#### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
1. **workflow_dispatchæ‰‹å‹•å®Ÿè¡Œ**
   ```bash
   gh workflow run slsa-provenance.yml -f tag=v2025.11.13
   ```

2. **releaseã‚¤ãƒ™ãƒ³ãƒˆè‡ªå‹•å®Ÿè¡Œ**
   - release.ymlã§releaseä½œæˆ
   - slsa-provenance.ymlãŒè‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

3. **pushã‚¤ãƒ™ãƒ³ãƒˆèª¤ç™ºç«é˜²æ­¢**
   - pushã‚¤ãƒ™ãƒ³ãƒˆã§slsa-provenance.ymlãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

#### æ¤œè¨¼æ–¹æ³•
- `scripts/verify_slsa_provenance.sh <RUN_ID> [TAG]` ã‚’ä½¿ç”¨

### 4. æˆåŠŸrunã®ç¢ºèªã‚¹ã‚¯ãƒªãƒ—ãƒˆ

#### ä½œæˆæ¸ˆã¿
- âœ… `scripts/verify_slsa_provenance.sh`
  - predicateTypeç¢ºèª
  - SHA256è¨ˆç®—
  - artifactæ¤œè¨¼
  - ã‚¿ã‚°ç¢ºèª

## ğŸ¯ å®Œäº†å®šç¾©ï¼ˆDoDï¼‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] dispatch / release ä¸¡æ–¹ã§æ­£å¸¸run
- [ ] event contextãŒæ­£ç¢ºã«ã‚¿ã‚°ã‚’è§£æ±º
- [ ] pushã‚¤ãƒ™ãƒ³ãƒˆã§èª¤ç™ºç«ã—ãªã„ã“ã¨ãŒç¢ºèª
- [ ] artifactãŒç”Ÿæˆã•ã‚Œ predicateTypeãŒæ­£ã—ã„

## ğŸ“‹ ãƒ•ã‚§ãƒ¼ã‚º1æˆæœã®è‡ªå‹•ç›£æŸ»è¨­å®š

### å®Ÿè£…äºˆå®š
- [ ] `/docs/reports/<date>/_manifest.json` ã¸ã®è‡ªå‹•è¿½è¨˜æ§‹æˆ
- [ ] Slacké€šçŸ¥ã‚¸ãƒ§ãƒ–ã®å‹•ä½œç¢ºèª
- [ ] Issueãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚¸ãƒ§ãƒ–ã®å‹•ä½œç¢ºèª
- [ ] Supabaseã¸ã®`v_ops_slsa_status`ç™»éŒ²ï¼ˆæ¬¡ãƒ•ã‚§ãƒ¼ã‚ºä¾å­˜ï¼‰

## ğŸ” ç›£æŸ»ãƒã‚§ãƒƒã‚¯é …ç›®

- [ ] predicateType ã®ç¢ºèª
- [ ] SHA256æ•´åˆæ€§ã®ç¢ºèª
- [ ] Slackãƒ­ã‚°ã®ç¢ºèª

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **workflow_dispatchã®`inputs.tag`ã‚’`required: false`ã«å¤‰æ›´**
2. **ãƒˆãƒªã‚¬ãƒ¼ãƒ†ã‚¹ãƒˆå®Ÿæ–½**
3. **æˆåŠŸrunã®æ¤œè¨¼**
4. **ç›£æŸ»è¨­å®šã®å®Ÿè£…**
