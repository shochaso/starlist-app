**11. 技術要件詳細**

**11.1 フロントエンド技術要件**

**11.1.1 Flutter アプリケーション構成**

- **最小SDKバージョン: Android API 21 (Android 5.0)、iOS 12.0**

- **Flutter バージョン: 3.10.0以上**

- **Dart バージョン: 3.0.0以上**

- **アーキテクチャパターン: Clean Architecture + MVVM**

- **状態管理: Riverpod（Provider, StateNotifier, AsyncValue）**

- **ルーティング: go_router または auto_route**

**11.1.2 パッケージ依存関係**

- **HTTP通信: dio, http**

- **ローカルストレージ: shared_preferences, sqflite, hive**

- **画像処理: cached_network_image, image_picker, photo_view**

- **認証: firebase_auth, supabase_auth, flutter_appauth**

- **UI/UXライブラリ: flutter_hooks, intl, shimmer, lottie**

- **解析/追跡: firebase_analytics, firebase_crashlytics**

- **オファーウォールSDK（各事業者指定のもの）**

**11.1.3 コード品質管理**

- **静的解析: dart analyze, flutter_lints**

- **テスト: flutter_test, mockito, bloc_test**

- **テストカバレッジ目標: 最低70%**

- **コーディング規約: Flutter公式スタイルガイド準拠**

**11.2 バックエンド技術要件**

**11.2.1 Supabase 構成**

- **PostgreSQL: バージョン14以上**

- **ストレージ: S3互換ストレージ**

- **リアルタイム機能: Postgresの変更通知機能**

- **認証: JWT、ソーシャルログイン連携**

- **Edge Functions: Deno ランタイム**

**11.2.2 データベース設計**

- **正規化レベル: 第3正規形を基本とし、必要に応じて非正規化**

- **インデックス戦略:**

  - **プライマリキー、外部キー**

  - **頻繁に使用される検索条件に対応するインデックス**

  - **複合インデックス（複数条件の検索最適化）**

- **RLS (Row Level Security): ユーザーロールに基づくアクセス制御**

- **パーティショニング: 大規模テーブルのシャーディング対応**

**11.2.3 API設計**

- **RESTful API: OpenAPI 3.0仕様準拠**

- **リアルタイム: WebSockets実装**

- **レート制限: IP/ユーザーベースの制限**

- **エラーハンドリング: 標準HTTPステータスコード、詳細エラーメッセージ**

- **Google認識振り分けAPI連携:
  ユーザーが取り込んだテキストデータを処理するためのGoogle Cloud Natural
  Language API等との連携インターフェース**

**11.3 インフラストラクチャ要件**

**11.3.1 クラウドインフラ**

- **ホスティング: AWS、Google Cloud Platform、またはAzure**

- **コンテナ化: Docker, Kubernetes（必要に応じて）**

- **CDN: Cloudflare、CloudFront、またはFastly**

- **負荷分散: サーバーレスアーキテクチャまたはロードバランサー**

**11.3.2 CI/CD**

- **パイプライン: GitHub Actions または CircleCI**

- **テスト自動化: ユニットテスト、統合テスト、E2Eテスト**

- **デプロイ戦略: Blue-Green、Canary**

- **環境: 開発、ステージング、本番**

**11.3.3 監視・ロギング**

- **アプリケーション監視: Firebase Crashlytics, Sentry**

- **パフォーマンス監視: Firebase Performance, New Relic**

- **ログ管理: Datadog, ELK Stack**

- **アラート: PagerDuty, OpsGenie**

**11.4 外部サービス連携**

**11.4.1 認証サービス**

- **OAuth/OpenID Connect: Google, Apple, Twitter, Instagram**

- **多要素認証: SMS, Authenticator App**

- **セッション管理: JWT, リフレッシュトークン**

**11.4.2 決済処理**

- **決済ゲートウェイ: Stripe, PayPal**

- **サブスクリプション管理: Stripe Billing**

- **課金イベントトラッキング: カスタムイベント追跡**

- **税務管理: 消費税自動計算、インボイス発行**

**11.4.3 外部API連携**

- **アフィリエイトASP API**

- **オファーウォール事業者API**

- **Google認識振り分けAPI: カテゴリ分類、エンティティ抽出等**

- **（注記：YouTube Data API, Spotify
  API等との連携は将来的な検討事項）**

**11.5 セキュリティ要件**

**11.5.1 認証・認可**

- **パスワード強度: NIST SP 800-63B準拠**

- **セッション管理: 適切なタイムアウト、トークン失効**

- **アクセス制御: 最小権限の原則、RBAC（ロールベースアクセス制御）**

**11.5.2 データ保護**

- **暗号化: 保存時AES-256、転送時TLS 1.3**

- **センシティブデータ: PII（個人識別情報）の特別保護**

- **データ消去: 削除リクエスト後30日以内の完全消去**

**11.5.3 脅威対策**

- **OWASP Top 10: 対応するセキュリティコントロール**

- **DDoS対策: CloudflareまたはAWS Shield**

- **脆弱性スキャン: 定期的な自動スキャン**

**11.6 パフォーマンス要件**

**11.6.1 応答時間**

- **API応答: 95%のリクエストが500ms以内**

- **画面描画: First Contentful Paint 1秒以内**

- **インタラクション遅延: 100ms以内**

**11.6.2 スケーラビリティ**

- **水平スケーリング:
  サーバーレスアーキテクチャまたはコンテナオーケストレーション**

- **データベース: 読み取り/書き込み分離、コネクションプーリング**

- **キャッシュ: 多層キャッシング戦略（CDN, アプリケーション, データ）**

**11.6.3 バッチ処理**

- **非同期タスク: キューベースの処理**

- **定期バッチ: スケジュールされたクラウド関数**

- **優先度制御: 重要タスクの優先処理**

**11.7 データ取り込みとカテゴリ分類処理**

**11.7.1 データ取り込み方法**

- **ユーザーがiPhoneやAndroidのOS標準OCR機能等を利用して抽出したテキストデータをコピー**

- **Starlistアプリ内の指定箇所にペーストしてデータを取り込む**

**11.7.2 取り込み対象データの例**

- **YouTube視聴履歴（動画タイトル、チャンネル名など）**

- **Spotify再生履歴（曲名、アーティスト名など）**

- **各種レシート情報（購入品目、店舗名など
  ＊店舗名は特定できない範囲で）**

- **その他、スターが共有したいテキストベースのデータ**

**11.7.3 テキストデータの処理パイプライン（Google API連携）**

- **データ構造理解:
  ユーザーが取り込んだテキストデータ（YouTube視聴履歴、Spotify再生履歴、レシート情報など）の構造を理解し、Google
  APIが処理しやすい形式に整形する**

- **情報抽出: Google
  APIを活用し、取り込まれたテキストデータから動画タイトル、チャンネル名、日時、カテゴリなどの情報を抽出・分類する**

- **重複検出: 類似項目の自動統合（可能な範囲で）**

- **ユーザー選択: Google
  APIによる処理結果をユーザーが確認し、公開する情報を選択的に取り込む**

- **後処理: Google APIによる処理結果のクリーニングと正規化**

**11.7.4 取り込まれたテキストデータの処理フロー（Google API連携）**

- **ユーザーがOS標準機能等でOCR抽出し、Starlistに取り込んだテキストデータをGoogle
  APIで処理。その際、住所や特定できる店舗情報などの機微情報は、スター自身が公開範囲を設定するか、システム側で可能な範囲でフィルタリング補助を行うことを検討する。**

**11.8 ストレスフリー構造の技術実装**

**11.8.1 コメント管理システム**

- **フィルタリングエンジン：**

  - **自然言語処理（NLP）を活用した感情分析**

  - **機械学習モデルによるコメント分類（ポジティブ/ネガティブ/中立）**

  - **カスタムルールエンジンによる禁止ワード検出**

- **データベース設計：**

  - **コメントステータス管理（承認済み/保留中/拒否済み）**

  - **コメント階層構造（親コメント/子コメント）**

  - **ユーザー信頼度スコアリング**

**11.8.2 有料商品提案システム**

- **決済処理：**

  - **マイクロトランザクション対応**

  - **複数料金プラン管理**

  - **返金ポリシー実装**

- **提案管理：**

  - **提案ステータス追跡**

  - **カテゴリ分類アルゴリズム**

  - **画像添付処理と最適化**

**11.8.3 アクセス制御システム**

- **権限管理：**

  - **ロールベースアクセス制御（RBAC）**

  - **動的権限割り当て**

  - **時間ベースのアクセス制限**

- **コンテンツ保護：**

  - **エンドツーエンド暗号化**

  - **デジタル著作権管理（DRM）**

  - **スクリーンショット検出と防止**

**11.8.4 コメント削除システム**

- **削除処理エンジン:**

  - **即時削除処理**

  - **関連データ（返信、リアクション）の連動処理**

  - **キャッシュ同期メカニズム**

- **ユーザーインターフェース:**

  - **直感的な削除操作フロー**

  - **一括削除のための選択インターフェース**

  - **削除履歴の可視化ダッシュボード**
